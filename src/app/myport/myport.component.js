"use strict";var __decorate=this&&this.__decorate||function(t,e,r,a){var o,i=arguments.length,n=i<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,r,a);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(n=(i<3?o(n):3<i?o(e,r,n):o(e,r))||n);return 3<i&&n&&Object.defineProperty(e,r,n),n};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),dateformat_1=require("../Share/dateformat"),operators_1=require("rxjs/operators"),http_1=require("@angular/common/http"),angular_highcharts_1=require("angular-highcharts"),MyportComponent=function(){function t(t,e,r,a){this.translate=t,this.basedataservice=e,this.myportservice=r,this.langservice=a,this.page="dashboard",this.dateformat=dateformat_1.datethai,this.userall={},this.userselect={},this.unitholderno="init",this.unitholder=0,this.balancedetail={},this.NAV=0,this.ProfitLoss=0,this.allunit=!1,t.addLangs(["th","en"])}return t.prototype.ngOnInit=function(){var e=this;this.getSelectListUnitholder(),$("#bottom-main-nav li").find("a").removeClass("current"),$("#bottom-main-nav li#myport").find("a").addClass("current"),this.langservice.listen().subscribe(function(t){console.log(t),e.lang=t})},t.prototype.onChange=function(t){if(this.reset(),0==t)this.getCurrentUser();else for(var e=0;e<this.userall.unitholderlist.length;e++)this.userall.unitholderlist[e].UnitholderId==t&&(this.userselect=this.userall.unitholderlist[e]);this.unitholder=t,this.getbalance()},t.prototype.print=function(){window.focus(),window.print()},t.prototype.getSelectListUnitholder=function(){var e=this;this.basedataservice.getSelectListUnitholder().pipe(operators_1.first()).subscribe(function(t){setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100),e.userall=t,e.unitholderno=e.userall.unitholderlist[0],e.getbalance(),1<e.userall.unitholderlist.length?(e.allunit=!0,e.getCurrentUser()):e.userselect=e.userall.unitholderlist[0]},function(t){console.log(t)})},t.prototype.getbalance=function(){var e=this,t=(new http_1.HttpParams).set("unitholderid",this.unitholder);this.myportservice.getbalance(t).subscribe(function(t){console.log(t),e.balancedetail=t,e.calTotal(),e.calchart(),e.generatechart()},function(t){console.log(t)})},t.prototype.calTotal=function(){for(var t=0;t<this.balancedetail.holdingbalance.length;t++)this.NAV+=parseFloat(this.balancedetail.holdingbalance[t].BalanceAmountTotal),this.ProfitLoss+=parseFloat(this.balancedetail.holdingbalance[t].GainLossTotal)},t.prototype.calchart=function(){for(var t=new Array,e=["#ED2B34","#00698C","#189D8C","#E99C92","#EFE5E4","#D5DF30","#7B99CF"],r=0;r<this.balancedetail.holdingbalance.length;r++){var a;a=100*this.balancedetail.holdingbalance[r].BalanceAmountTotal/this.NAV,t.push({name:this.balancedetail.holdingbalance[r].FundTypeEng,y:a,color:e[r]})}this.chartdetail=t,console.log(this.chartdetail)},t.prototype.getCurrentUser=function(){this.useralluniholder=this.basedataservice.getmemberInfo()},t.prototype.reset=function(){this.NAV=0,this.ProfitLoss=0,this.useralluniholder={},this.userselect={}},t.prototype.generatechart=function(){this.chart=new angular_highcharts_1.Chart({chart:{type:"pie"},title:{text:""},credits:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{}},showInLegend:!0}},series:[{data:this.chartdetail}]})},t=__decorate([core_1.Component({selector:"app-myport",templateUrl:"./myport.component.html",styleUrls:["./myport.component.scss"]})],t)}();exports.MyportComponent=MyportComponent;