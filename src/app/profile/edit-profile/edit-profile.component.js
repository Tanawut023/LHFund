"use strict";var __decorate=this&&this.__decorate||function(o,t,e,r){var i,s=arguments.length,n=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,e):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(o,t,e,r);else for(var l=o.length-1;0<=l;l--)(i=o[l])&&(n=(s<3?i(n):3<s?i(t,e,n):i(t,e))||n);return 3<s&&n&&Object.defineProperty(t,e,n),n};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),operators_1=require("rxjs/operators"),http_1=require("@angular/common/http"),forms_1=require("@angular/forms"),dateformat_1=require("../../Share/dateformat"),EditProfileComponent=function(){function o(o,t,e){this.basedataservice=o,this.profileserice=t,this.fb=e,this.userall={},this.userselect={},this.unitholderno="init",this.profile={},this.res={},this.addreszipcode={},this.addreszipcodeforselect={},this.show=!1,this.loading=!1}return o.prototype.ngOnInit=function(){this.createFormValidate(),this.getaddresslist(),$("#mutual-tab-menu").find("li").removeClass("current"),$("#mutual-tab-menu").find("li#menu1").addClass("current")},o.prototype.openmodal=function(){$("#otpprofile").modal({backdrop:"static",keyboard:!1,show:!0})},o.prototype.onChange=function(){for(var o=0;o<this.userall.unitholderlist.length;o++)this.userall.unitholderlist[o].UnitholderId==this.unitholderno.UnitholderId&&(this.userselect=this.userall.unitholderlist[o]);this.getprofileinfo()},o.prototype.getSelectListUnitholder=function(){var t=this;this.basedataservice.getSelectListUnitholder().pipe(operators_1.first()).subscribe(function(o){setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100),t.userall=o,t.unitholderno=t.userall.unitholderlist[0],t.userselect=t.userall.unitholderlist[0],t.getprofileinfo()},function(o){console.log(o)})},o.prototype.getprofileinfo=function(){var e=this,o=(new http_1.HttpParams).set("unitholderid",this.userselect.UnitholderId);this.profileserice.getprofileinfo(o).pipe(operators_1.first()).subscribe(function(o){for(var t in setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100),console.log(o),e.profile=o,e.countrylist)e.countrylist.hasOwnProperty(t)&&e.profile.unitholderinfo.ContactCountry==e.countrylist[t].CountryName&&(e.profile.unitholderinfo.ContactCountry=e.countrylist[t]);for(var t in e.provincelist)e.provincelist.hasOwnProperty(t)&&e.profile.unitholderinfo.ContactProvince==e.provincelist[t].ProvinceName&&(e.profile.unitholderinfo.ContactProvince=e.provincelist[t]);e.changeprovince(e.profile.umpurlist[0].ProvinceID),e.changeumpur(e.profile.tumbollist[0].UmpurID),setTimeout(function(){e.setdefault()},100)},function(o){console.log(o)})},o.prototype.getaddresslist=function(){var t=this;this.profileserice.getaddresslist().pipe(operators_1.first()).subscribe(function(o){setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100),t.countrylist=o.countrylist,t.provincelist=o.provincelist,t.getSelectListUnitholder(),console.log(t.countrylist),console.log(t.provincelist)},function(o){console.log(o)})},o.prototype.createFormValidate=function(){this.form=this.fb.group({address:[null,[forms_1.Validators.required]],tambon:["",[forms_1.Validators.required]],amphur:["",[forms_1.Validators.required]],province:["",[forms_1.Validators.required]],postcode:[null,[forms_1.Validators.required]],country:[null,[forms_1.Validators.required]],Mphone:[null],Ophone:[null],Faxno:[null],allowtax:[null,[forms_1.Validators.required]]}),this.formotp=this.fb.group({otp:[null,[forms_1.Validators.required,forms_1.Validators.pattern(/^[0-9]*$/)]]})},o.prototype.onSubmited=function(){var t=this;if(console.log(this.form),this.form.valid){this.isNotValid=!1,this.loading=!0;var o={Id:this.profile.unitholderinfo.Id,UnitHolderID:this.profile.unitholderinfo.UnitHolderID,OfficePhoneNo:this.form.controls.Ophone.value,HomePhoneNo:this.form.controls.Mphone.value,FaxNo:this.form.controls.Faxno.value,ContactAddress1:this.form.controls.address.value,ContactAddress2:"ต."+this.form.controls.tambon.value.TumbolName+" อ."+this.form.controls.amphur.value.UmpurName,ContactTumbolID:this.form.controls.tambon.value.TumbolID,ContactTumbol:this.form.controls.tambon.value.TumbolName,ContactUmpurID:this.form.controls.amphur.value.UmpurID,ContactUmpur:this.form.controls.amphur.value.UmpurName,ContactProvinceID:this.form.controls.province.value.ProvinceID,ContactProvince:this.form.controls.province.value.ProvinceName,ContactCountryID:this.form.controls.country.value.CountryID,ContactCountry:this.form.controls.country.value.CountryName,ContactZipCode:this.form.controls.postcode.value,AllowWithholdTax:this.form.controls.allowtax.value};this.user=o,console.log(o),this.profileserice.submiteditprofile(this.user).pipe(operators_1.first()).subscribe(function(o){t.res=o,console.log(o),t.loading=!1,$("#otpprofile").modal({backdrop:"static",keyboard:!1,show:!0})},function(o){console.log(o),t.loading=!1,t.message=o.error.messages,$("#message").modal({backdrop:"static",keyboard:!1,show:!0})})}else this.isNotValid=!0,this.validateAllFormFields(this.form)},o.prototype.setdefault=function(){this.form.controls.address.setValue(this.profile.unitholderinfo.ContactAddress1,{onlySelf:!0}),this.form.controls.tambon.setValue(this.profile.unitholderinfo.ContactTumbol,{onlySelf:!0}),this.form.controls.amphur.setValue(this.profile.unitholderinfo.ContactUmpur,{onlySelf:!0}),this.form.controls.province.setValue(this.profile.unitholderinfo.ContactProvince,{onlySelf:!0}),this.form.controls.postcode.setValue(this.profile.unitholderinfo.ContactZipCode,{onlySelf:!0}),this.form.controls.country.setValue(this.profile.unitholderinfo.ContactCountry,{onlySelf:!0}),this.form.controls.Mphone.setValue(this.profile.unitholderinfo.HomePhoneNo,{onlySelf:!0}),this.form.controls.Ophone.setValue(this.profile.unitholderinfo.OfficePhoneNo,{onlySelf:!0}),this.form.controls.Faxno.setValue(this.profile.unitholderinfo.FaxNo,{onlySelf:!0}),this.form.controls.allowtax.setValue(this.profile.unitholderinfo.AllowWithholdTax,{onlySelf:!0})},o.prototype.numberOnly=function(o){var t=o.which?o.which:o.keyCode;return!(31<t&&(t<48||57<t))},o.prototype.requestotp=function(){var t=this;this.loading=!0,this.basedataservice.requestotp().subscribe(function(o){console.log(o),t.res=o,t.loading=!1},function(o){console.log(o),t.loading=!1})},o.prototype.updateprofile=function(){var t=this;if(console.log(this.formotp),this.formotp.valid){this.isNotValid=!1,this.loading=!0;var o=new http_1.HttpParams;o=(o=o.append("otp",this.formotp.controls.otp.value)).append("refcode",this.res.refcode);var e={Id:this.profile.unitholderinfo.Id,UnitHolderID:this.profile.unitholderinfo.UnitHolderID,OfficePhoneNo:this.form.controls.Ophone.value,HomePhoneNo:this.form.controls.Mphone.value,FaxNo:this.form.controls.Faxno.value,ContactAddress1:this.form.controls.address.value,ContactAddress2:"ต."+this.form.controls.tambon.value.TumbolName+" อ."+this.form.controls.amphur.value.UmpurName,ContactTumbolID:this.form.controls.tambon.value.TumbolID,ContactProvince:this.form.controls.province.value.ProvinceName,ContactCountry:this.form.controls.country.value.CountryName,ContactZipCode:this.form.controls.postcode.value,AllowWithholdTax:this.form.controls.allowtax.value,UpdateFlag:"string",CreateDate:dateformat_1.getDate()};console.log(e),this.profileserice.updateprofile(e,o).pipe(operators_1.first()).subscribe(function(o){t.res=o,t.loading=!1,console.log(o),$("#otpprofile").modal("toggle"),t.message="บันทึกข้อมูลสำเร็จ",setTimeout(function(){$("#message").modal({backdrop:"static",keyboard:!1,show:!0})},100),t.formotp.reset()},function(o){console.log(o),t.loading=!1,t.message=o.error.messages})}else this.isNotValid=!0,this.validateAllFormFields(this.formotp)},o.prototype.reset=function(){this.getprofileinfo(),this.message=""},o.prototype.autoselected=function(){var e=this;if(this.form.controls.postcode.value){var o=new http_1.HttpParams;o=o.append("zipcode",this.form.controls.postcode.value),this.profileserice.getaddressbyzipcode(o).pipe(operators_1.first()).subscribe(function(o){for(var t in setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100),console.log(o),e.addreszipcodeforselect=o,e.provincelist)e.provincelist.hasOwnProperty(t)&&e.addreszipcodeforselect.provinceid==e.provincelist[t].ProvinceID&&(e.profile.unitholderinfo.ContactProvince=e.provincelist[t],e.form.controls.province.setValue(e.profile.unitholderinfo.ContactProvince,{onlySelf:!0}),console.log("here"))},function(o){$("#otpprofile").modal("toggle"),console.log(o),e.message=o.error.error_description,$("#message").modal({backdrop:"static",keyboard:!1,show:!0})})}},o.prototype.changeprovince=function(o){var e=this;this.addreszipcodeforselect.provinceid;var t=new http_1.HttpParams;t=t.append("provinceid",o),this.profileserice.changeprovince(t).pipe(operators_1.first()).subscribe(function(o){for(var t in setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100),console.log(o),e.amphurlist=o.umpurlist,e.zipcode=o.zipcode,e.amphurlist)e.amphurlist.hasOwnProperty(t)&&e.profile.unitholderinfo.ContactUmpur==e.amphurlist[t].UmpurName&&(e.profile.unitholderinfo.ContactUmpur=e.amphurlist[t],console.log("here1"))},function(o){console.log(o),e.message=o.error.error_description,$("#message").modal({backdrop:"static",keyboard:!1,show:!0})})},o.prototype.changeumpur=function(o){var e=this;this.addreszipcodeforselect.provinceid;var t=new http_1.HttpParams;t=t.append("umpurid",o),this.profileserice.changeumpur(t).pipe(operators_1.first()).subscribe(function(o){for(var t in setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100),console.log(o),e.tambonlist=o.tumbollist,e.tambonlist)e.tambonlist.hasOwnProperty(t)&&e.profile.unitholderinfo.ContactTumbol==e.tambonlist[t].TumbolName&&(e.profile.unitholderinfo.ContactTumbol=e.tambonlist[t],console.log("here2"))},function(o){console.log(o),e.message=o.error.error_description,$("#message").modal({backdrop:"static",keyboard:!1,show:!0})})},o.prototype.changetambon=function(o){var t=this;this.addreszipcodeforselect.provinceid;var e=new http_1.HttpParams;e=e.append("tumbolid",o),this.profileserice.changetumbol(e).pipe(operators_1.first()).subscribe(function(o){setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100),console.log(o),t.zipcode=o.zipcode,t.form.controls.postcode.setValue(t.zipcode,{onlySelf:!0}),t.form.controls.postcode.updateValueAndValidity()},function(o){console.log(o),t.message=o.error.error_description,$("#message").modal({backdrop:"static",keyboard:!1,show:!0})})},o.prototype.onprovincechange=function(){this.show=!0,this.tambonlist=[],this.changeprovince(this.form.controls.province.value.ProvinceID),this.form.controls.amphur.reset(),this.form.controls.postcode.reset(),this.form.controls.tambon.reset()},o.prototype.onamphurchange=function(){this.changeumpur(this.form.controls.amphur.value.UmpurID)},o.prototype.ontambonchange=function(){this.show=!1,this.changetambon(this.form.controls.tambon.value.TumbolID)},o.prototype.validateAllFormFields=function(e){var r=this;Object.keys(e.controls).forEach(function(o){var t=e.get(o);t instanceof forms_1.FormControl?t.markAsTouched({onlySelf:!0}):t instanceof forms_1.FormGroup&&r.validateAllFormFields(t)})},o.prototype.isFieldNotValid1=function(o){return!this.formotp.get(o).valid&&this.formotp.get(o).touched},o.prototype.ValidatorDisplayCss1=function(o){return{"has-danger":this.isFieldNotValid1(o)}},o.prototype.isFieldNotValid=function(o){return!this.form.get(o).valid&&this.form.get(o).touched},o.prototype.ValidatorDisplayCss=function(o){return{"has-danger":this.isFieldNotValid(o)}},o.prototype.ngOnDestroy=function(){},o.prototype.print=function(){window.focus(),window.print()},o=__decorate([core_1.Component({selector:"app-edit-profile",templateUrl:"./edit-profile.component.html",styleUrls:["./edit-profile.component.scss"]})],o)}();exports.EditProfileComponent=EditProfileComponent;