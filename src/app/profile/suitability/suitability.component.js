"use strict";var __decorate=this&&this.__decorate||function(e,t,s,i){var o,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;0<=l;l--)(o=e[l])&&(n=(r<3?o(n):3<r?o(t,s,n):o(t,s))||n);return 3<r&&n&&Object.defineProperty(t,s,n),n};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),dateformat_1=require("../../Share/dateformat"),operators_1=require("rxjs/operators"),http_1=require("@angular/common/http"),forms_1=require("@angular/forms"),SuitabilityComponent=function(){function e(e,t,s,i){this.basedataservice=e,this.profileserice=t,this.fb=s,this.langservice=i,this.page="over-view",this.dateformat=dateformat_1.datethai,this.userall={},this.userselect={},this.unitholderno="init",this.answer=[],this.loading=!1}return e.prototype.ngOnInit=function(){var t=this;this.createFormValidate(),this.getSelectListUnitholder(),$("#mutual-tab-menu").find("li").removeClass("current"),$("#mutual-tab-menu").find("li#menu2").addClass("current"),this.langservice.listen().subscribe(function(e){console.log(e),t.lang=e})},e.prototype.checkpage=function(e){switch(window.scroll(0,0),console.log(e),setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100),e){case"suitability-test":this.page="suitability-test";break;case"suitability-score":this.onsubmit();break;case"over-view":this.getriskprofile(),this.page="over-view";break;default:this.page="over-view",console.log(this.page)}},e.prototype.checktype=function(e){console.log(e.srcElement.attributes.id);var t=e.srcElement.attributes.id.nodeValue;console.log(t),"size10"==t?($("#personal").addClass("active"),$("#answerC1").find('input[type="radio"]').attr("disabled","disabled"),$("#answerC2").find('input[type="radio"]').attr("disabled","disabled"),$("#answerC2").find('input[type="text"]').attr("disabled","disabled")):($("#personal").removeClass("active"),$("#answerC1").find('input[type="radio"]').removeAttr("disabled"),$("#answerC2").find('input[type="radio"]').removeAttr("disabled"),$("#answerC2").find('input[type="text"]').removeAttr("disabled")),"size15"==t?($("#company").addClass("active"),$("#answerP1").find('input[type="radio"]').attr("disabled","disabled"),$("#answerP2").find('input[type="radio"]').attr("disabled","disabled")):($("#company").removeClass("active"),$("#answerP1").find('input[type="radio"]').removeAttr("disabled"),$("#answerP2").find('input[type="radio"]').removeAttr("disabled"))},e.prototype.disable=function(){console.log("test"),$("#answerC1").find('input[type="radio"]').attr("disabled","disabled"),$("#answerC2").find('input[type="radio"]').attr("disabled","disabled"),$("#answerP1").find('input[type="radio"]').attr("disabled","disabled"),$("#answerP2").find('input[type="radio"]').attr("disabled","disabled")},e.prototype.onChange=function(){for(var e=0;e<this.userall.unitholderlist.length;e++)this.userall.unitholderlist[e].UnitholderId==this.unitholderno.UnitholderId&&(this.userselect=this.userall.unitholderlist[e]);this.getsuitest(),this.getriskprofile()},e.prototype.getSelectListUnitholder=function(){var t=this;this.basedataservice.getSelectListUnitholder().pipe(operators_1.first()).subscribe(function(e){setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100),t.userall=e,t.unitholderno=t.userall.unitholderlist[0],t.userselect=t.userall.unitholderlist[0],t.getsuitest(),t.getriskprofile()},function(e){console.log(e)})},e.prototype.getsuitest=function(){var t=this;this.reset();var e=(new http_1.HttpParams).set("unitholderid",this.userselect.UnitholderId);this.profileserice.getrisksuitest(e).pipe(operators_1.first()).subscribe(function(e){t.suitest=e,console.log(t.suitest),setTimeout(function(){t.autocreateformcontrol()},100)},function(e){console.log(e)})},e.prototype.autocreateformcontrol=function(){if(this.suitest)for(var e=0;e<this.suitest.question.length;e++){this.question.push(this.fb.control(""));for(var t=0;t<this.suitest.question[e].Answers.length;t++)1==this.suitest.question[e].Answers[t].Selected&&this.question.controls[e].setValue(this.suitest.question[e].Answers[t],{onlySelf:!0})}console.log(this.form)},e.prototype.getriskprofile=function(){var t=this,e=(new http_1.HttpParams).set("unitholderid",this.userselect.UnitholderId);this.profileserice.changeUnitholder(e).pipe(operators_1.first()).subscribe(function(e){console.log(e),t.riskprofile=e.riskProfile},function(e){console.log(e),t.message=e.error.messages,$("#message").modal({backdrop:"static",keyboard:!1,show:!0})})},Object.defineProperty(e.prototype,"question",{get:function(){return this.form.get("question")},enumerable:!0,configurable:!0}),e.prototype.createFormValidate=function(){this.form=this.fb.group({question:this.fb.array([])}),this.formotp=this.fb.group({otp:[null,[forms_1.Validators.required,forms_1.Validators.pattern(/^[0-9]*$/)]]})},e.prototype.setdefault=function(){this.form.controls.choice0.setValue(this.answer[0],{onlySelf:!0}),this.form.controls.choice1.setValue(this.answer[1],{onlySelf:!0}),this.form.controls.choice2.setValue(this.answer[2],{onlySelf:!0}),this.form.controls.choice3.setValue(this.answer[3],{onlySelf:!0}),this.form.controls.choice4.setValue(this.answer[4],{onlySelf:!0}),this.form.controls.choice5.setValue(this.answer[5],{onlySelf:!0}),this.form.controls.choice6.setValue(this.answer[6],{onlySelf:!0}),this.form.controls.choice7.setValue(this.answer[7],{onlySelf:!0}),this.form.controls.choice8.setValue(this.answer[8],{onlySelf:!0}),this.form.controls.choice9.setValue(this.answer[9],{onlySelf:!0}),this.form.controls.choice10.setValue(this.answer[10],{onlySelf:!0})},e.prototype.onsubmit=function(){var t=this;console.log(this.form);var e=new Array;if(this.form.valid){this.isNotValid=!1,this.show=!0,this.loading=!0;for(var s=0;s<this.suitest.question.length;s++){var i=this.question.at(s);e.push({Id:this.suitest.question[s].Id,Seq:this.suitest.question[s].Seq,Name:this.suitest.question[s].Name,NameEng:this.suitest.question[s].NameEng,UnitHolderID:this.suitest.question[s].UnitHolderID,Answers:[{Id:i.value.Id,QuestionId:i.value.QuestionId,Seq:i.value.Seq,Score:i.value.Score,Name:i.value.Name,NameEng:i.value.NameEng,Selected:!0}]})}console.log(e),this.suitestselected=e,console.log(this.suitestselected),this.profileserice.calculateriskprofile(this.suitestselected).pipe(operators_1.first()).subscribe(function(e){console.log(e),t.loading=!1,t.resulttest=e.riskprofilerank,t.page="suitability-score"},function(e){console.log(e),t.loading=!1,t.message=e.error.messages,$("#message").modal({backdrop:"static",keyboard:!1,show:!0})})}else this.isNotValid=!0,this.validateAllFormFields(this.form)},e.prototype.validateAllFormFields=function(s){var i=this;Object.keys(s.controls).forEach(function(e){var t=s.get(e);t instanceof forms_1.FormControl?t.markAsTouched({onlySelf:!0}):t instanceof forms_1.FormGroup&&i.validateAllFormFields(t)})},e.prototype.summitriskprofile=function(){var t=this;this.loading=!0,this.profileserice.submiteditriskprofile().pipe(operators_1.first()).subscribe(function(e){console.log(e),t.loading=!1,t.resultsubmit=e,$("#otpsuitest").modal({backdrop:"static",keyboard:!1,show:!0})},function(e){console.log(e),t.loading=!1,t.message=e.error.messages,$("#message").modal({backdrop:"static",keyboard:!1,show:!0})})},e.prototype.updatesuitest=function(){var t=this;if(console.log(this.formotp),this.formotp.valid){this.isNotValid=!1,this.loading=!0;var e=new http_1.HttpParams;e=(e=e.append("otp",this.formotp.controls.otp.value)).append("refcode",this.resultsubmit.refcode),console.log(this.suitestselected),this.profileserice.saveriskprofile(this.suitestselected,e).pipe(operators_1.first()).subscribe(function(e){console.log("here1"),t.loading=!1,console.log(e),t.show=!1,$("#otpsuitest").modal("toggle"),$("#messagesuc").modal({backdrop:"static",keyboard:!1,show:!0}),t.reset(),t.getsuitest()},function(e){console.log("here2"),console.log(e),t.loading=!1,t.message=e.error.messages})}else this.isNotValid=!0,this.validateAllFormFields(this.formotp)},e.prototype.numberOnly=function(e){var t=e.which?e.which:e.keyCode;return!(31<t&&(t<48||57<t))},e.prototype.isFieldNotValid1=function(e){return!this.formotp.get(e).valid&&this.formotp.get(e).touched},e.prototype.ValidatorDisplayCss1=function(e){return{"has-danger":this.isFieldNotValid1(e)}},e.prototype.requestotp=function(){var t=this;this.loading=!0,this.basedataservice.requestotp().subscribe(function(e){console.log(e),t.resultsubmit=e,t.loading=!1},function(e){console.log(e),t.loading=!1})},e.prototype.reset=function(){this.formotp.reset(),this.form.reset(),this.answer=[],this.suitest={},this.message=""},e.prototype.print=function(){window.focus(),window.print()},e=__decorate([core_1.Component({selector:"app-suitability",templateUrl:"./suitability.component.html",styleUrls:["./suitability.component.scss"]})],e)}();exports.SuitabilityComponent=SuitabilityComponent;