"use strict";function passwordConfirming(o){if(o.parent&&o){var t=o.parent.get("newpassword"),e=o.parent.get("confirmpassword");if(t&&e)return t.value!==e.value?{invalid:!0}:void 0}}var __decorate=this&&this.__decorate||function(o,t,e,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,e):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(o,t,e,s);else for(var n=o.length-1;0<=n;n--)(r=o[n])&&(a=(i<3?r(a):3<i?r(t,e,a):r(t,e))||a);return 3<i&&a&&Object.defineProperty(t,e,a),a};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),operators_1=require("rxjs/operators"),http_1=require("@angular/common/http"),forms_1=require("@angular/forms"),ChangepasswordComponent=function(){function o(o,t,e,s){this.fb=o,this.basedataservice=t,this.profileservice=e,this.toastr=s,this.userall={},this.userselect={},this.unitholderno="init",this.isNotValid=!1,this.res={},this.loading=!1}return Object.defineProperty(o.prototype,"cpwd",{get:function(){return this.formchangepass.get("confirmpassword")},enumerable:!0,configurable:!0}),o.prototype.ngOnInit=function(){this.createFormValidate(),this.getSelectListUnitholder(),$("#mutual-tab-menu").find("li").removeClass("current"),$("#mutual-tab-menu").find("li#menu3").addClass("current")},o.prototype.onChange=function(){for(var o=0;o<this.userall.unitholderlist.length;o++)this.userall.unitholderlist[o].UnitholderId==this.unitholderno.UnitholderId&&(this.userselect=this.userall.unitholderlist[o])},o.prototype.getSelectListUnitholder=function(){var t=this;this.basedataservice.getSelectListUnitholder().pipe(operators_1.first()).subscribe(function(o){setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100),t.userall=o,t.unitholderno=t.userall.unitholderlist[0],t.userselect=t.userall.unitholderlist[0]},function(o){console.log(o)})},o.prototype.createFormValidate=function(){this.formchangepass=this.fb.group({currentpassword:[null,[forms_1.Validators.required,forms_1.Validators.minLength(8),forms_1.Validators.pattern(/^(?=.*[A-Z])(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{8,}$/)]],newpassword:[null,[forms_1.Validators.required,forms_1.Validators.minLength(8),forms_1.Validators.pattern(/^(?=.*[A-Z])(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{8,}$/)]],confirmpassword:[null,[forms_1.Validators.required,passwordConfirming,forms_1.Validators.minLength(8),forms_1.Validators.pattern(/^(?=.*[A-Z])(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{8,}$/)]]}),this.formotp=this.fb.group({otp:[null,[forms_1.Validators.required,forms_1.Validators.pattern(/^[0-9]*$/)]]})},o.prototype.onSubmit=function(){var t=this;if(console.log(this.formchangepass),this.formchangepass.valid){this.isNotValid=!1,this.loading=!0;var o={CurrentPassword:this.formchangepass.controls.currentpassword.value,NewPassword:this.formchangepass.controls.newpassword.value,ConfirmPassword:this.formchangepass.controls.confirmpassword.value};this.profileservice.submitchangepassword(o).pipe(operators_1.first()).subscribe(function(o){console.log(o),t.loading=!1,t.res=o,$("#otpchangepassword").modal({backdrop:"static",keyboard:!1,show:!0})},function(o){console.log(o),t.loading=!1,t.message=o.error.messages,$("#message").modal({backdrop:"static",keyboard:!1,show:!0})})}else this.isNotValid=!0,this.validateAllFormFields(this.formchangepass)},o.prototype.updatepassword=function(){var t=this;if(console.log(this.formotp.controls.otp.value),console.log(this.formchangepass),this.formotp.valid){this.isNotValid=!1,console.log("test"),this.loading=!0;var o=new http_1.HttpParams;o=(o=o.append("otp",this.formotp.controls.otp.value)).append("refcode",this.res.refcode);var e={CurrentPassword:this.formchangepass.controls.currentpassword.value,NewPassword:this.formchangepass.controls.newpassword.value,ConfirmPassword:this.formchangepass.controls.confirmpassword.value};console.log("test"+o+e),this.profileservice.updatepassword(e,o).pipe(operators_1.first()).subscribe(function(o){console.log(o),t.res=o,t.loading=!1,$("#otpchangepassword").modal("toggle"),t.message="เปลี่ยนรหัสผ่านสำเร็จ",$("#message").modal({backdrop:"static",keyboard:!1,show:!0})},function(o){console.log(o),t.loading=!1,t.message=o.error.messages})}else this.isNotValid=!0,this.validateAllFormFields(this.formotp)},o.prototype.reset=function(){this.message="",this.createFormValidate()},o.prototype.validateAllFormFields=function(e){var s=this;Object.keys(e.controls).forEach(function(o){var t=e.get(o);t instanceof forms_1.FormControl?t.markAsTouched({onlySelf:!0}):t instanceof forms_1.FormGroup&&s.validateAllFormFields(t)})},o.prototype.isFieldNotValid=function(o){return!this.formchangepass.get(o).valid&&this.formchangepass.get(o).touched},o.prototype.ValidatorDisplayCss=function(o){return{"has-danger":this.isFieldNotValid(o)}},o.prototype.isFieldNotValid4=function(o){return!this.formotp.get(o).valid&&this.formotp.get(o).touched},o.prototype.ValidatorDisplayCss4=function(o){return{"has-danger":this.isFieldNotValid4(o)}},o.prototype.numberOnly=function(o){var t=o.which?o.which:o.keyCode;return!(31<t&&(t<48||57<t))},o.prototype.requestotp=function(){var t=this;this.loading=!0,this.basedataservice.requestotp().subscribe(function(o){console.log(o),t.res=o,t.loading=!1},function(o){console.log(o),t.loading=!1})},o.prototype.print=function(){window.focus(),window.print()},o=__decorate([core_1.Component({selector:"app-changepassword",templateUrl:"./changepassword.component.html",styleUrls:["./changepassword.component.scss"]})],o)}();exports.ChangepasswordComponent=ChangepasswordComponent;