"use strict";function passwordConfirming(t){if(t.parent&&t){var e=t.parent.get("password"),o=t.parent.get("repeatPassword");if(e&&o)return e.value!==o.value?{invalid:!0}:void 0}}var __decorate=this&&this.__decorate||function(t,e,o,s){var r,a=arguments.length,i=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,s);else for(var n=t.length-1;0<=n;n--)(r=t[n])&&(i=(a<3?r(i):3<a?r(e,o,i):r(e,o))||i);return 3<a&&i&&Object.defineProperty(e,o,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),forms_1=require("@angular/forms"),http_1=require("@angular/common/http"),ChangepasswordloginComponent=function(){function t(t,e,o,s,r,a){this.fb=t,this.route=e,this.router=o,this.translate=s,this.authenticationService=r,this.toastr=a,this.isNotValid=!1,this.comfirmchange=!1,this.page="changepassword",this.blind="",this.refcode={},this.activate={},this.User={},this.exit=!1,s.addLangs(["th","en"])}return Object.defineProperty(t.prototype,"cpwd",{get:function(){return this.formchange.get("repeatPassword")},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){var o=this;this.createFormValidate(),this.foo1=this.translate.currentLang,"th"==this.foo1?this.langth=!0:"en"==this.foo1&&(this.langen=!0),this.route.params.subscribe(function(t){o.refcode=t;var e=(new http_1.HttpParams).set("refcode",o.refcode.refcode);o.authenticationService.validateActivateCode(e).subscribe(function(t){console.log(t)},function(t){console.log(t),o.exit=!0,o.message=t.error.messages[0],console.log(o.message),$("#dialog").modal({backdrop:"static",keyboard:!1,show:!0})}),console.log(t)})},t.prototype.switchlang=function(t){"th"==t?(this.translate.use("th"),this.langen=!1,this.langth=!0,localStorage.setItem("lang",t)):"en"==t&&(this.translate.use("en"),this.langth=!1,this.langen=!0,localStorage.setItem("lang",t))},t.prototype.checkpage=function(t){var e=this;switch(console.log(t),t){case"otp":if(console.log(this.formchange),this.formchange.valid){this.isNotValid=!1;var o=(new http_1.HttpParams).set("refcode",this.refcode.refcode),s={Password:this.formchange.controls.password.value,ConfirmPassword:this.formchange.controls.repeatPassword.value};console.log(s),this.authenticationService.confirmForgotPassword(s,o).subscribe(function(t){console.log(t),e.User=t,e.page="otp",e.mobile=e.User.mobile},function(t){console.log(t),e.message=t.error.messages,$("#dialog").modal({backdrop:"static",keyboard:!1,show:!0})})}else this.isNotValid=!0,this.validateAllFormFields(this.formchange);break;case"complete":if(this.formotp.valid){this.isNotValid=!1;var r=new http_1.HttpParams;r=(r=r.append("otp",this.formotp.controls.otp.value)).append("refcode",this.User.refcode);s={Password:this.formchange.controls.password.value,ConfirmPassword:this.formchange.controls.repeatPassword.value};this.authenticationService.OTPForgotPassword(s,r).subscribe(function(t){console.log(t),e.exit=!0,e.message="ท่านได้ทำการเปลี่ยนรหัสผ่านเรียบร้อยแล้ว",$("#dialog").modal({backdrop:"static",keyboard:!1,show:!0})},function(t){console.log(t),e.message=t.error.messages,$("#dialog").modal({backdrop:"static",keyboard:!1,show:!0})})}else this.isNotValid=!0,this.validateAllFormFields(this.formotp);break;default:this.page="changepassword",console.log(this.page)}},t.prototype.createFormValidate=function(){this.formchange=this.fb.group({password:[null,[forms_1.Validators.required,forms_1.Validators.minLength(8),forms_1.Validators.pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[$@$!%*#?&]).{8,16}$/)]],repeatPassword:[null,[forms_1.Validators.required,passwordConfirming,forms_1.Validators.minLength(8),forms_1.Validators.pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[$@$!%*#?&]).{8,16}$/)]]}),this.formotp=this.fb.group({otp:[null,[forms_1.Validators.required,forms_1.Validators.pattern(/^[0-9]*$/)]]})},t.prototype.validateAllFormFields=function(o){var s=this;Object.keys(o.controls).forEach(function(t){var e=o.get(t);e instanceof forms_1.FormControl?e.markAsTouched({onlySelf:!0}):e instanceof forms_1.FormGroup&&s.validateAllFormFields(e)})},t.prototype.isFieldNotValid5=function(t){return!this.formchange.get(t).valid&&this.formchange.get(t).touched},t.prototype.ValidatorDisplayCss5=function(t){return{"has-danger":this.isFieldNotValid5(t)}},t.prototype.isFieldNotValid4=function(t){return!this.formotp.get(t).valid&&this.formotp.get(t).touched},t.prototype.ValidatorDisplayCss4=function(t){return{"has-danger":this.isFieldNotValid4(t)}},t.prototype.navigate=function(t){t=t;console.log(t),this.router.navigate([t],{relativeTo:this.route})},t.prototype.numberOnly=function(t){var e=t.which?t.which:t.keyCode;return!(31<e&&(e<48||57<e))},t.prototype.requestotp=function(){var e=this,t=(new http_1.HttpParams).set("refcode",this.User.refcode);this.authenticationService.requestOTP(t).subscribe(function(t){console.log(t),e.User=t},function(t){console.log(t),e.message=t.error.messages,$("#dialog").modal({backdrop:"static",keyboard:!1,show:!0})})},t=__decorate([core_1.Component({selector:"app-changepasswordlogin",templateUrl:"./changepasswordlogin.component.html",styleUrls:["./changepasswordlogin.component.scss"]})],t)}();exports.ChangepasswordloginComponent=ChangepasswordloginComponent;