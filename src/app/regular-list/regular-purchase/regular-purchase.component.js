"use strict";var __decorate=this&&this.__decorate||function(e,t,o,s){var r,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,s);else for(var a=e.length-1;0<=a;a--)(r=e[a])&&(i=(n<3?r(i):3<n?r(t,o,i):r(t,o))||i);return 3<n&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),operators_1=require("rxjs/operators"),http_1=require("@angular/common/http"),forms_1=require("@angular/forms"),dateformat_1=require("../../Share/dateformat"),customValidationService=function(){function e(){}return e.checkLimit=function(o,s){return function(e){console.log(e.value);var t=e.value;return t&&(t=t.replace(",",""),t=parseFloat(t)),0==t?(console.log("Is 0"),{invalid:!0}):t&&(isNaN(t)||t<o||s<t||0==t)?{invalid:!0}:null}},e}();exports.customValidationService=customValidationService;var RegularPurchaseComponent=function(){function e(e,t,o,s){this.basedataservice=e,this.standingorderservice=t,this.fb=o,this.langservice=s,this.page="regular-purchase",this.model={},this.userall={},this.userselect={},this.unitholderno="init",this.IsEdit=!1,this.dateless=!1,this.loading=!1}return Object.defineProperty(e.prototype,"cpwd",{get:function(){return this.formsubstanding.get("amount")},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var t=this;this.getSelectListUnitholder(),this.createFormValidate(),$("#mutual-tab-menu").find("li").removeClass("current"),$("#mutual-tab-menu").find("li#menu1").addClass("current"),this.langservice.listen().subscribe(function(e){console.log(e),t.lang=e});for(var e=new Array,o=1;o<=31;o++)e.push(o);console.log(e),this.month=e;var s=new Date;this.minDate={year:s.getFullYear(),month:s.getMonth()+1,day:s.getDate()}},e.prototype.checkpage=function(e){switch(window.scroll(0,0),console.log(e),e){case"regular-purchase":this.page="regular-purchase";break;case"regular-purchase-step1":this.page="regular-purchase-step1";break;default:this.page="regular-purchase",console.log(this.page)}},e.prototype.onChange=function(){for(var e=0;e<this.userall.unitholderlist.length;e++)this.userall.unitholderlist[e].UnitholderId==this.unitholderno.UnitholderId&&(this.userselect=this.userall.unitholderlist[e])},e.prototype.createFormValidate=function(){this.formsubstanding=this.fb.group({amount:[null,[forms_1.Validators.required,customValidationService.checkLimit(1e3,999999999999)]],datestart:[null,[forms_1.Validators.required]],dateend:[null,[forms_1.Validators.required]],fund:["",[forms_1.Validators.required]],day:[1]})},e.prototype.validateAllFormFields=function(o){var s=this;Object.keys(o.controls).forEach(function(e){var t=o.get(e);t instanceof forms_1.FormControl?t.markAsTouched({onlySelf:!0}):t instanceof forms_1.FormGroup&&s.validateAllFormFields(t)})},e.prototype.isFieldNotValid=function(e){return!this.formsubstanding.get(e).valid&&this.formsubstanding.get(e).touched},e.prototype.ValidatorDisplayCss=function(e){return{"has-danger":this.isFieldNotValid(e)}},e.prototype.getSelectListUnitholder=function(){var t=this;this.basedataservice.getSelectListUnitholder().pipe(operators_1.first()).subscribe(function(e){setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100),t.userall=e,t.unitholderno=t.userall.unitholderlist[0],t.userselect=t.userall.unitholderlist[0],t.getbanklist(),t.getfundlist(),t.getstnadingorder()},function(e){console.log(e)})},e.prototype.getbanklist=function(){var t=this,e=(new http_1.HttpParams).set("unitholderid",this.userselect.UnitholderId);this.standingorderservice.changeunitholder(e).pipe(operators_1.first()).subscribe(function(e){console.log(e),t.banklist=e.data,t.banklist.bankaccountlist[0]?t.Bank=t.banklist.bankaccountlist[0].BankName+" ("+t.banklist.bankaccountlist[0].BankAccountNo+")":0==t.banklist.bankaccountlist.length&&(t.Bank="ไม่พบบัญชีธนาคาร")},function(e){console.log(e)})},e.prototype.getfundlist=function(){var t=this;this.standingorderservice.getfundlist().pipe(operators_1.first()).subscribe(function(e){console.log(e),t.fundlist=e,setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100)},function(e){console.log(e)})},e.prototype.onSubmited=function(){if(console.log(this.formsubstanding),this.Islevel=!1,this.Isprotect=!1,this.dateless=!1,this.formsubstanding.valid)if(1==this.userselect.RiskLevelExpire)console.log("expire"),$("#expiremodal").modal({backdrop:"static",keyboard:!1,show:!0});else if(this.banklist.bankaccountlist[0]){var e=new Date(this.formsubstanding.controls.datestart.value.year,this.formsubstanding.controls.datestart.value.month-1,this.formsubstanding.controls.datestart.value.day).getTime(),t=new Date(this.formsubstanding.controls.dateend.value.year,this.formsubstanding.controls.dateend.value.month-1,this.formsubstanding.controls.dateend.value.day).getTime();if(console.log(e,t),t<e)return console.log("less more"),void(this.dateless=!0);console.log("motto"),this.checkexpireandlevel()}else this.message="ติดต่อเจ้าหน้าที่การตลาด เบอร์ติดต่อ 02-286-3484 หรือ 02-679-2155 เพื่อดำเนินขอเปิดบัญชี ATS",setTimeout(function(){$("#message").modal({backdrop:"static",keyboard:!1,show:!0})},100);else this.isNotValid=!0,this.validateAllFormFields(this.formsubstanding)},e.prototype.reset=function(){console.log("reset"),this.createFormValidate(),this.getbanklist(),this.getfundlist(),this.getstnadingorder()},e.prototype.tofix=function(e){if(console.log(e),e){var t=e;t=t.replace(",","");var o=parseFloat(t).toFixed(2);o=o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),console.log(o),this.formsubstanding.controls.amount.setValue(o,{onlySelf:!0})}},e.prototype.numberOnly=function(e){var t=e.which?e.which:e.keyCode;return console.log(t),!(31<t&&(t<48||57<t)&&46!==t)},e.prototype.checkexpireandlevel=function(){var t=this;this.loading=!0;var e={UnitHolderID:this.userselect.UnitholderId,FundID:this.formsubstanding.controls.fund.value.FundID};console.log(e),this.standingorderservice.changefund(e).pipe(operators_1.first()).subscribe(function(e){console.log(e),t.loading=!1,e.messages?(t.message=e.messages,t.Islevel=!0,t.Islevel&&(console.log("level"),$("#risklevel").modal({backdrop:"static",keyboard:!1,show:!0})),"N"==t.formsubstanding.controls.fund.value.isFullyHedge&&(console.log("protect"),t.Isprotect=!0,$("#risklevel").modal({backdrop:"static",keyboard:!1,show:!0}))):t.confirm()},function(e){console.log(e),t.loading=!1,t.message=e.error.messages,$("#message").modal({backdrop:"static",keyboard:!1,show:!0})}),setTimeout(function(){},100)},e.prototype.confirm=function(){var e,t=this;this.loading=!0,this.isNotValid=!1,this.datestart=this.formsubstanding.controls.datestart.value.year+"-"+this.formsubstanding.controls.datestart.value.month+"-"+this.formsubstanding.controls.datestart.value.day,this.datestart=dateformat_1.boostrapdatepicker(this.datestart),this.dateend=this.formsubstanding.controls.dateend.value.year+"-"+this.formsubstanding.controls.dateend.value.month+"-"+this.formsubstanding.controls.dateend.value.day,this.dateend=dateformat_1.boostrapdatepicker(this.dateend),e={StandingOrderDate:dateformat_1.getDate(),StandingUnitHolderID:this.userselect.UnitholderId,StandingOrderFundID:this.formsubstanding.controls.fund.value.FundID,StandingOrderTxType:"Subscription",StandingOrderAmount:this.formsubstanding.controls.amount.value,StandingOrderPeriod:"Month",StandingOrderDayNo:this.formsubstanding.controls.day.value,ExpiryDate:this.dateend,StandingOrderEffectiveDate:this.datestart,IDCardNo:this.banklist.bankaccountlist[0].BankAccountID},console.log(e),this.standingorderservice.submitstandingorder(e).pipe(operators_1.first()).subscribe(function(e){console.log(e),t.resultsubmit=e,t.message="ทำรายการสำเร็จ",t.loading=!1,setTimeout(function(){$("#message").modal({backdrop:"static",keyboard:!1,show:!0})},100),t.reset()},function(e){console.log(e),t.loading=!1,t.message=e.error.messages,$("#message").modal({backdrop:"static",keyboard:!1,show:!0})})},e.prototype.getstnadingorder=function(){var t=this;this.nolist=!1;var e=(new http_1.HttpParams).set("unitholderid",this.userselect.UnitholderId);this.standingorderservice.getstnadingorder(e).pipe(operators_1.first()).subscribe(function(e){console.log(e),t.standingorder=e,t.standingorder.standingorderlist||(t.nolist=!0)},function(e){console.log(e)})},e.prototype.modaldeleteorder=function(e,t){this.deletedOrder=t,this.deletedGroup=e,$("#delete").modal({backdrop:"static",keyboard:!1,show:!0})},e.prototype.deleteorder=function(){var t=this,e={UnitHolderID:this.deletedOrder.StandingUnitHolderID,StandingOrderID:this.deletedOrder.StandingOrderID};this.standingorderservice.cancelstnadingorder(e).pipe(operators_1.first()).subscribe(function(e){console.log(e),t.getstnadingorder(),$("#delete").modal("toggle")},function(e){console.log(e),$("#delete").modal("toggle"),t.message=e.error.messages,$("#message").modal({backdrop:"static",keyboard:!1,show:!0})})},e.prototype.print=function(){window.focus(),window.print()},e=__decorate([core_1.Component({selector:"app-regular-purchase",templateUrl:"./regular-purchase.component.html",styleUrls:["./regular-purchase.component.scss"]})],e)}();exports.RegularPurchaseComponent=RegularPurchaseComponent;