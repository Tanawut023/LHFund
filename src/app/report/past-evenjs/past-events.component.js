"use strict";var __decorate=this&&this.__decorate||function(t,e,o,n){var r,s=arguments.length,i=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(i=(s<3?r(i):3<s?r(e,o,i):r(e,o))||i);return 3<s&&i&&Object.defineProperty(e,o,i),i};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),operators_1=require("rxjs/operators"),http_1=require("@angular/common/http"),forms_1=require("@angular/forms"),PastEventsComponent=function(){function t(t,e,o){this.basedataservice=t,this.reportservice=e,this.fb=o,this.model={},this.userall={},this.userselect={},this.unitholderno="init",this.loading=!1,this.p=1,this.nolist=!1}return t.prototype.ngOnInit=function(){this.createFormValidate(),this.getSelectListUnitholder(),this.getfundtypelist(),$("#mutual-tab-menu").find("li").removeClass("current"),$("#mutual-tab-menu").find("li#menu4").addClass("current");var t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1);console.log(e),this.minDate={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()}},t.prototype.onChange=function(){for(var t=0;t<this.userall.unitholderlist.length;t++)this.userall.unitholderlist[t].UnitholderId==this.unitholderno.UnitholderId&&(this.userselect=this.userall.unitholderlist[t])},t.prototype.createFormValidate=function(){this.form=this.fb.group({fundtype:[0],fundname:[0,forms_1.Validators.required],startDate:[null,forms_1.Validators.required],endDate:[null,forms_1.Validators.required]})},t.prototype.isFieldNotValid=function(t){return!this.form.get(t).valid&&this.form.get(t).touched},t.prototype.ValidatorDisplayCss=function(t){return{"has-danger":this.isFieldNotValid(t)}},t.prototype.validateAllFormFields=function(o){var n=this;Object.keys(o.controls).forEach(function(t){var e=o.get(t);e instanceof forms_1.FormControl?e.markAsTouched({onlySelf:!0}):e instanceof forms_1.FormGroup&&n.validateAllFormFields(e)})},t.prototype.changefundtype=function(){var e=this,t=this.form.controls.fundtype.value,o=new http_1.HttpParams;o=(o=o.append("fundtypeid",t)).append("unitholderid",this.userselect.UnitholderId),this.reportservice.changefundtype(o).pipe(operators_1.first()).subscribe(function(t){console.log(t),e.Fundnamelist=t.fundlist,e.form.controls.fundname.setValue(0,{onlySelf:!0}),setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100)},function(t){console.log(t)})},t.prototype.getstartdate=function(){return this.form.controls.startDate.value.year+"-"+this.form.controls.startDate.value.month+"-"+this.form.controls.startDate.value.day},t.prototype.getenddate=function(){return this.form.controls.endDate.value.year+"-"+this.form.controls.endDate.value.month+"-"+this.form.controls.endDate.value.day},t.prototype.getSelectListUnitholder=function(){var e=this;this.basedataservice.getSelectListUnitholder().pipe(operators_1.first()).subscribe(function(t){e.userall=t,e.unitholderno=e.userall.unitholderlist[0],e.userselect=e.userall.unitholderlist[0],e.changefundtype()},function(t){console.log(t)})},t.prototype.getfundtypelist=function(){var e=this;this.reportservice.getfundtypelist().subscribe(function(t){console.log(t),e.Fundtypelist=t.fundtypelist},function(t){console.log(t)})},t.prototype.OnSubmitd=function(){var e=this;console.log(this.form),this.loading=!0,this.nolist=!1;var t,o=new http_1.HttpParams;o=(o=o.append("currentpage","1")).append("rowperpage","999"),0!=this.form.controls.fundtype.value&&0==this.form.controls.fundname.value?(this.form.controls.fundname.setErrors({invalid:!0}),this.loading=!1):this.form.valid?(this.statementreport=[],t=0==this.form.controls.fundtype.value&&0==this.form.controls.fundname.value?{UnitholderID:this.userselect.UnitholderId,FundID:this.form.controls.fundname.value,StartOrderDate:this.getstartdate(),EndOrderDate:this.getenddate()}:{UnitholderID:this.userselect.UnitholderId,FundID:this.form.controls.fundname.value.FundID,StartOrderDate:this.getstartdate(),EndOrderDate:this.getenddate()},console.log(t),this.reportservice.statementreport(t,o).subscribe(function(t){console.log(t),e.statementreport=t,0==e.statementreport.statementreport.length&&(e.nolist=!0,console.log("notlist")),e.calulatetable(),e.loading=!1},function(t){console.log(t),e.loading=!1})):(this.loading=!1,this.validateAllFormFields(this.form))},t.prototype.calulatetable=function(){var t=new Array,e=0;if(console.log("test"),this.statementreport.statementreport[0])for(var o=0;o<this.statementreport.statementreport[0].StatementFunds.length;o++){console.log("fori");for(var n=0,r=0;r<this.statementreport.statementreport[0].StatementFunds[o].StatementDetails.length;r++){var s;console.log("fory"),s=this.statementreport.statementreport[0].StatementFunds[o].StatementDetails[r],0!=e&&0!=n||this.statementreport.statementreport[0].StatementFunds[o].FundID==s.FundID&&(s.FundCode=this.statementreport.statementreport[0].StatementFunds[o].FundCode,s.FundName=this.statementreport.statementreport[0].StatementFunds[o].FundName,s.FundNameEng=this.statementreport.statementreport[0].StatementFunds[o].FundNameEng),t.push(s),console.log(s),n++,10==++e&&(e=0)}}this.statementlist=t,console.log(this.statementlist)},t.prototype.reset=function(){console.log("reset"),this.statementreport="",this.statementlist=[],this.p=1,this.loading=!1,this.createFormValidate(),this.getfundtypelist(),this.changefundtype()},t.prototype.print=function(){window.focus(),window.print()},t=__decorate([core_1.Component({selector:"app-past-events",templateUrl:"./past-events.component.html",styleUrls:["./past-events.component.scss"]})],t)}();exports.PastEventsComponent=PastEventsComponent;