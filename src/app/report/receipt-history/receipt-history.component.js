"use strict";var __decorate=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,s=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var d=t.length-1;0<=d;d--)(i=t[d])&&(s=(n<3?i(s):3<n?i(e,o,s):i(e,o))||s);return 3<n&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),operators_1=require("rxjs/operators"),http_1=require("@angular/common/http"),dateformat_1=require("../../Share/dateformat"),forms_1=require("@angular/forms"),ReceiptHistoryComponent=function(){function t(t,e,o,r){this.basedataservice=t,this.reportservice=e,this.fb=o,this.langservice=r,this.model={},this.userall={},this.userselect={},this.unitholderno="init",this.fundtype=0,this.fundname=0,this.current=1,this.row=999,this.p=1,this.loading=!1,this.nolist=!1}return t.prototype.ngOnInit=function(){var e=this;this.createFormValidate(),this.getSelectListUnitholder(),this.getfundtypelist(),this.langservice.listen().subscribe(function(t){console.log(t),e.lang=t}),$("#mutual-tab-menu").find("li").removeClass("current"),$("#mutual-tab-menu").find("li#menu3").addClass("current");var t=new Date,o=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1);console.log(o),this.minDate={year:o.getFullYear(),month:o.getMonth()+1,day:o.getDate()}},t.prototype.onChange=function(){for(var t=0;t<this.userall.unitholderlist.length;t++)this.userall.unitholderlist[t].UnitholderId==this.unitholderno.UnitholderId&&(this.userselect=this.userall.unitholderlist[t])},t.prototype.createFormValidate=function(){this.form=this.fb.group({fundtype:[0],fundname:[0,forms_1.Validators.required],startDate:[null,forms_1.Validators.required],endDate:[null,forms_1.Validators.required]})},t.prototype.isFieldNotValid=function(t){return!this.form.get(t).valid&&this.form.get(t).touched},t.prototype.ValidatorDisplayCss=function(t){return{"has-danger":this.isFieldNotValid(t)}},t.prototype.validateAllFormFields=function(o){var r=this;Object.keys(o.controls).forEach(function(t){var e=o.get(t);e instanceof forms_1.FormControl?e.markAsTouched({onlySelf:!0}):e instanceof forms_1.FormGroup&&r.validateAllFormFields(e)})},t.prototype.changefundtype=function(){var e=this,t=this.form.controls.fundtype.value,o=new http_1.HttpParams;o=(o=o.append("fundtypeid",t)).append("unitholderid",this.userselect.UnitholderId),this.reportservice.changefundtype(o).pipe(operators_1.first()).subscribe(function(t){console.log(t),e.Fundnamelist=t.fundlist,e.form.controls.fundname.setValue(0,{onlySelf:!0}),setTimeout(function(){$(".selectpicker").selectpicker("refresh")},100)},function(t){console.log(t)})},t.prototype.getstartdate=function(){return this.form.controls.startDate.value.year+"-"+this.form.controls.startDate.value.month+"-"+this.form.controls.startDate.value.day},t.prototype.getenddate=function(){return this.form.controls.endDate.value.year+"-"+this.form.controls.endDate.value.month+"-"+this.form.controls.endDate.value.day},t.prototype.getSelectListUnitholder=function(){var e=this;this.basedataservice.getSelectListUnitholder().pipe(operators_1.first()).subscribe(function(t){console.log(t),e.userall=t,e.unitholderno=e.userall.unitholderlist[0],e.userselect=e.userall.unitholderlist[0],e.changefundtype()},function(t){console.log(t)})},t.prototype.getfundtypelist=function(){var e=this;this.reportservice.getfundtypelist().subscribe(function(t){console.log(t),e.Fundtypelist=t.fundtypelist},function(t){console.log(t)})},t.prototype.OnSubmitd=function(){var e=this;this.loading=!0,this.nolist=!1;var t,o=new http_1.HttpParams;o=(o=o.append("currentpage","1")).append("rowperpage","999"),console.log(this.form),0!=this.form.controls.fundtype.value&&0==this.form.controls.fundname.value?(this.form.controls.fundname.setErrors({invalid:!0}),this.loading=!1):this.form.valid?(this.dividendreport=[],t=0==this.form.controls.fundtype.value&&0==this.form.controls.fundname.value?{UnitholderID:this.userselect.UnitholderId,FundTypeID:0,FundCode:"",StartXDDate:this.getstartdate(),EndXDDate:this.getenddate(),TransactionDate:dateformat_1.getDate()}:{UnitholderID:this.userselect.UnitholderId,FundTypeID:this.form.controls.fundtype.value,FundCode:this.form.controls.fundname.value.FundCode,StartXDDate:this.getstartdate(),EndXDDate:this.getenddate(),TransactionDate:dateformat_1.getDate()},console.log(t),this.reportservice.dividendreport(t,o).subscribe(function(t){console.log(t),e.dividendreport=t,0==e.dividendreport.dividendreport.length&&(e.nolist=!0,console.log("notlist")),e.calulatetable(),e.loading=!1},function(t){console.log(t),e.loading=!1})):(this.validateAllFormFields(this.form),this.loading=!1)},t.prototype.calulatetable=function(){var t=new Array;console.log("test");for(var e=0,o=1,r=0,i=0;i<this.dividendreport.dividendreport.length;i++){console.log("fori");var n=0,s=0,d=0,l=0;r+=this.dividendreport.dividendreport[i].DividendPayment.length;for(var a=0;a<this.dividendreport.dividendreport[i].DividendPayment.length;a++){var u;console.log("fory"),n+=parseFloat(this.dividendreport.dividendreport[i].DividendPayment[a].DividendAmount),s+=parseFloat(this.dividendreport.dividendreport[i].DividendPayment[a].DividendWithHoldingTax),d+=parseFloat(this.dividendreport.dividendreport[i].DividendPayment[a].NetDividendAmount),u=this.dividendreport.dividendreport[i].DividendPayment[a],0!=e&&0!=l||this.dividendreport.dividendreport[i].FundCode==u.FundCode&&(u.FundCode=this.dividendreport.dividendreport[i].FundCode,u.FundName=this.dividendreport.dividendreport[i].FundName,u.FundNameEng=this.dividendreport.dividendreport[i].FundNameEng),9!=e&&o!=r||(u.balance=n,u.tax=s,u.net=d,d=s=n=0),t.push(u),console.log(u),l++,o++,10==++e&&(e=0)}}this.reportlist=t,console.log(this.reportlist)},t.prototype.reset=function(){console.log("reset"),this.Fundnamelist=[],this.dividendreport="",this.reportlist=[],this.p=1,this.createFormValidate(),this.getfundtypelist(),this.changefundtype()},t.prototype.print=function(){window.focus(),window.print()},t=__decorate([core_1.Component({selector:"app-receipt-history",templateUrl:"./receipt-history.component.html",styleUrls:["./receipt-history.component.scss"]})],t)}();exports.ReceiptHistoryComponent=ReceiptHistoryComponent;